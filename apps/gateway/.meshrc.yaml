sources:
  - name: TheGraph
    handler:
      graphql:
        endpoint: https://api.thegraph.com/subgraphs/name/sovereign-nature/sni
  - name: Pinata
    handler:
      jsonSchema:
        endpoint: https://gateway.pinata.cloud/
        operations:
          - type: Query
            field: ipfsMetadata
            path: /ipfs/{args.cid}
            method: GET
            responseSchema: ./json-schemas/metadata.json
    transforms:
      - resolversComposition:
          mode: bare
          compositions:
            - resolver: 'Query.ipfsMetadata'
              composer: './middleware/getCid.ts'
additionalTypeDefs: |
  extend type SNI {
    metadata: Identifier_Token_Metadata
  }
additionalResolvers:
  - targetTypeName: SNI
    targetFieldName: metadata
    sourceName: Pinata # Which source does the target field belong to?
    sourceTypeName: Query # Which root type does the target field belong to?
    sourceFieldName: ipfsMetadata # What is the source field name?
    requiredSelectionSet: |
      {
        tokenURI
      }
    sourceArgs: # What args does this need to take?
      cid: '{root.tokenURI}'
